<image schemaversion="7.5" name="piccolo-os-prod">
  <description type="system">
    <author>Piccolo</author>
    <contact>oss@piccolospace.com</contact>
    <specification>MicroOS-based hardened production appliance with piccolod - USB bootable disk image - ZERO ACCESS</specification>
  </description>

  <preferences>
    <type image="oem" filesystem="btrfs" firmware="uefi" eficsm="false" efipartsize="1024" efiparttable="gpt">
      <bootloader name="systemd_boot" />
    </type>
    <version>1.0.0</version>
    <rpm-excludedocs>true</rpm-excludedocs>
    <rpm-check-signatures>true</rpm-check-signatures>
    <locale>en_US</locale>
    <keytable>us</keytable>
    <timezone>UTC</timezone>
    <packagemanager>zypper</packagemanager>
  </preferences>

  <!-- Use faster mirror closer to your location -->
  <repository type="rpm-md">
    <source path="https://download.opensuse.org/tumbleweed/repo/oss/" />
  </repository>
  <repository type="rpm-md">
    <source path="https://download.opensuse.org/tumbleweed/repo/non-oss/" />
  </repository>
  <repository type="rpm-md">
    <source path="https://download.opensuse.org/update/tumbleweed/" />
  </repository>

  <packages type="bootstrap">
    <package name="coreutils" />
    <package name="gawk" />
    <package name="gzip" />
    <package name="hostname" />
    <package name="openssl" />
    <package name="libz1" />
    <package name="filesystem" />
    <package name="glibc-locale-base" />
    <package name="ca-certificates-mozilla" />
  </packages>

  <packages type="image">
    <!-- MicroOS Base Patterns - MINIMAL PRODUCTION SET -->
    <package name="patterns-microos-basesystem" />
    <package name="patterns-microos-base-zypper" />
    <package name="patterns-microos-defaults" />

    <!-- Required for OEM disk image -->
    <package name="dracut-kiwi-oem-dump" />
    <package name="dracut-kiwi-oem-repart" />
    <package name="kernel-default" />

    <!-- PRODUCTION NETWORKING - NetworkManager only for container networking -->
    <package name="NetworkManager" />
    <package name="chrony" />

    <!-- CONTAINER RUNTIME - Podman only -->
    <package name="podman" />
    <package name="conmon" />
    <package name="crun" />

    <!-- PRODUCTION SECURITY: NO SSH, NO CLOUD-INIT, NO DEBUG TOOLS -->
    <!-- openssh-server - REMOVED FOR PRODUCTION -->
    <!-- cloud-init - REMOVED FOR PRODUCTION -->
    <!-- cloud-init-config-MicroOS - REMOVED FOR PRODUCTION -->

    <!-- DEV_PACKAGES_INSERT_POINT -->

    <!-- Boot chain - systemd-boot for MicroOS -->
    <package name="shim" />
    <package name="systemd-boot" />
    <package name="sdbootutil" />

    <!-- Microcode -->
    <package name="ucode-amd" />
    <package name="ucode-intel" />

    <!-- Essential for atomic updates -->
    <package name="transactional-update" />
    <package name="rebootmgr" />

    <!-- PRODUCTION HARDENING: Minimal logging -->
    <package name="systemd" />
    <package name="systemd-logger" />
  </packages>

</image>